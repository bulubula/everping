{% extends "base.html" %}
{% block content %}
<div class="card mb-3">
  <div class="card-body d-flex justify-content-between align-items-center flex-wrap gap-3 py-2">
    <div>
      <h2 class="mb-0">Tasks</h2>
      <div class="text-muted small">Manage jobs and triggers.</div>
    </div>
    <div class="d-flex gap-2">
      <a class="btn btn-primary" href="{{ request.url_for('task_new') }}">New</a>
      <form action="{{ request.url_for('jobs_reload') }}" method="post">
        <button type="submit" class="btn btn-outline-secondary">Reload</button>
      </form>
    </div>
    {% if jobs_error %}
    <div class="w-100 text-danger small mt-1">{{ jobs_error }}</div>
    {% endif %}
  </div>
</div>

<div class="table-responsive">
<table class="table table-striped align-middle">
  <thead>
    <tr><th>ID</th><th>Name</th><th>Type</th><th>Enabled</th><th>Action</th></tr>
  </thead>
  <tbody>
  {% for t in tasks %}
  <tr>
    <td>{{ t.id }}</td>
    <td><a href="{{ request.url_for('task_detail', task_id=t.id) }}">{{ t.name }}</a></td>
    <td>{{ t.type }}</td>
    <td>{{ t.enabled }}</td>
    <td>
      <form action="{{ request.url_for('run_now', task_id=t.id) }}" method="post" style="display:inline;">
        <button type="submit" class="btn">Run now</button>
      </form>
      <form action="{{ request.url_for('task_delete', task_id=t.id) }}" method="post" style="display:inline;">
        <button type="submit" class="btn btn-danger" onclick="return confirm('Delete task?')">Delete</button>
      </form>
    </td>
  </tr>
  {% endfor %}
  </tbody>
</table>
</div>
{% endblock %}
